
# قالب اشتراک مارزبان

![CI](https://github.com/YrustPd/Subscription-Template/actions/workflows/ci.yml/badge.svg)

یک صفحه فرود تیره و مینیمال برای لینک‌های اشتراک مارزبان که وضعیت کاربر، ترافیک، کلاینت‌های پیشنهادی، QR و لینک‌های پشتیبانی را در یک نما ارائه می‌کند. قالب با سینتکس جینجا سازگار است و مستقیماً در مسیر قالب‌های سفارشی مارزبان مستقر می‌شود.  
**نسخه فعلی:** v1.0.0

---

## فهرست مطالب
- [ویژگی‌ها](#ویژگیها)
- [پیش‌نیازها](#پیشنیازها)
- [نصب](#نصب)
  - [فعال‌سازی لینک اشتراک](#فعال‌سازی-لینک-اشتراک)
  - [استقرار صفحه اشتراک](#استقرار-صفحه-اشتراک)
- [شخصی‌سازی](#شخصی‌سازی)
- [پشتیبانی و مشارکت](#پشتیبانی-و-مشارکت)
- [مجوز](#مجوز)

---

## ویژگی‌ها
- **اکشن‌های سریع:** دکمه کپی، نمایش QR و دیپ‌لینک برای کلاینت‌های رایج iOS، اندروید، ویندوز و لینوکس.
- **نمایش زنده اطلاعات:** وضعیت کاربر، میزان ترافیک باقی‌مانده، شمارش معکوس تمدید و فهرست سرورها مستقیماً از داده‌های مارزبان.
- **لینک‌های پویا:** آدرس‌های پشتیبانی، اسپانسر و راهنما در صورت مقداردهی، بخش‌ها و دکمه‌های مرتبط را فعال می‌کنند.
- **دسترس‌پذیری:** مدیریت فوکوس، حالت کاهش انیمیشن و سازگاری با Safe Area برای دستگاه‌های مدرن.
- **چندزبانه:** نسخه انگلیسی (`template/index.html`) و فارسی (`template/index.fa.html`) با چیدمان آینه‌ای و فونت شبنم.

## پیش‌نیازها
- دسترسی شِل به سروری که مارزبان روی آن نصب شده است.
- گواهی SSL معتبر برای دامنه پنل و لینک اشتراک.
- ابزارهایی مانند `wget` برای دریافت فایل‌های قالب.

## نصب

### فعال‌سازی لینک اشتراک
1. مطابق آموزش رسمی **How to generate SSL** برای دامنه خود گواهی SSL تهیه کنید و سپس با **Activating SSL in Marzban** آن را فعال کنید تا پنل و لینک اشتراک روی HTTPS در دسترس باشند.
2. اگر پنل و لینک اشتراک روی یک دامنه هستند، همین کافی است. در غیر این صورت، یک گواهی چنددامنه‌ای تهیه کنید و خط زیر را در فایل `.env` (با حذف `#` ابتدای آن) مقداردهی کنید:
   ```dotenv
   XRAY_SUBSCRIPTION_URL_PREFIX=https://YOUR_DOMAIN:PORT
   ```
   **توجه:** اگر پنل روی پورتی به جز ۴۴۳ کار می‌کند، همان پورت را در مقدار بالا بنویسید. برای ربات تلگرام هم تنظیم این متغیر ضروری است؛ در غیر این صورت لینک‌های اشتراک که از ربات کپی می‌شوند قالب صحیحی نخواهند داشت.
3. برای اعمال تغییرات، مارزبان را ری‌استارت کنید:
   ```bash
   sudo marzban restart
   ```

پس از این مراحل، لینک اشتراک فعال است و با ساخت هر کاربر جدید، آدرس تازه‌ای در اختیار او قرار می‌گیرد. برای جزئیات متغیرهای تکمیلی به مستند «Configuration» در وب‌سایت مارزبان مراجعه کنید.

### استقرار صفحه اشتراک
1. فایل قالب را در مسیر مربوطه قرار دهید:
   ```bash
   sudo mkdir -p /var/lib/marzban/templates/subscription
   sudo wget -N -P /var/lib/marzban/templates/subscription/ https://raw.githubusercontent.com/YrustPd/Subscription-Template/main/template/index.html
   ```
   _اختیاری (نسخه فارسی):_ فایل `index.fa.html` را با نام `index.html` جایگزین کنید تا زبان پیش‌فرض فارسی شود:
   ```bash
   sudo wget -N -O /var/lib/marzban/templates/subscription/index.html https://raw.githubusercontent.com/YrustPd/Subscription-Template/main/template/index.fa.html
   ```
2. در فایل `.env` واقع در `/opt/marzban/`، خطوط زیر را از حالت کامنت خارج کرده و مقداردهی کنید:
   ```dotenv
   CUSTOM_TEMPLATES_DIRECTORY="/var/lib/marzban/templates/"
   SUBSCRIPTION_PAGE_TEMPLATE="subscription/index.html"
   ```
3. مارزبان را ری‌استارت کنید:
   ```bash
   sudo marzban restart
   ```

حالا یکی از لینک‌های اشتراک کاربر را در مرورگر باز کنید تا صفحه جدید نمایش داده شود. فاوآیکن و تصویر پیش‌نمایش به صورت پیش‌فرض از گیت‌هاب بارگذاری می‌شوند و نیازی به دانلود جداگانه ندارند. برای تغییر زبان پیش‌فرض، مقدار `<select>` انتهای فایل `index.html` را به گزینه دلخواه تغییر دهید.

## شخصی‌سازی
- **برندسازی:** تگ `<link rel="icon">` و متاهای `og:image` / `twitter:image` به صورت کامنت قرار دارند و به طور پیش‌فرض به نسخه آنلاین `logo-dark.png` در گیت‌هاب اشاره می‌کنند؛ بنابراین نیازی به دانلود جداگانه نیست. در صورت حذف کامنت و جایگزینی لینک دلخواه، می‌توانید فاوآیکن و تصویر پیش‌نمایش اختصاصی خود را فعال کنید.
- **فهرست کلاینت‌ها:** کارت‌های مربوط به سیستم‌عامل‌ها را ویرایش کنید تا نام، توضیح و لینک کلاینت‌هایی که به کاربران پیشنهاد می‌دهید نمایش داده شود.
- **لینک‌های پشتیبانی:** متغیرهای `support_url`، `sponsor_url` و `how_to_url` را هنگام ساخت کاربر مقداردهی کنید تا دکمه‌های شناور مربوطه فعال شوند.
- **چیدمان:** اگر به تغییرات ظاهری نیاز دارید، فایل‌های CSS داخلی را که در `<style>` تعریف شده‌اند ویرایش کنید؛ ساختار با تفسیرگر جینجا کاملاً سازگار است.

## پشتیبانی و مشارکت
- به‌روزرسانی‌های مهم در [`CHANGELOG.md`](CHANGELOG.md) ثبت می‌شود.
- برای ارسال Pull Request، ابتدا [`CONTRIBUTING.md`](CONTRIBUTING.md) را مطالعه کنید تا با استانداردها و روند بررسی آشنا شوید.

## مجوز
این پروژه تحت مجوز [GNU AGPL v3](LICENSE) منتشر شده است.
